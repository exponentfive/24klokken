<!DOCTYPE html>
<html lang="no">
<head>
<meta charset="UTF-8">
<title>24Klokke -locale</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
@font-face {
    font-family: "DSEG7ClassicLocal";
    src: url("assets/fonts/DSEG7Classic-Regular.woff2") format("woff2");
    font-weight: 400;
    font-style: normal;
    font-display: swap;
}

body {
    background: #0b1020;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    margin: 0;
    font-family: Arial, sans-serif;
    color: white;
    transition: background 4s ease;
}

.clock-container {
    position: relative;
    width: min(90vw, 420px);
    height: min(90vw, 420px);
    max-width: 420px;
    max-height: 420px;
    margin: 1rem auto;
}

.clock {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
}

/* Rings */
.circle {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    border-radius: 50%;
    box-sizing: border-box;
}

.day-ring {
    border: solid gold;
    opacity: 0.15;
    box-shadow: 0 0 10px rgba(255,200,50,0.2);
    transition: opacity 4s ease, box-shadow 4s ease;
}

.night-ring {
    border: solid #4a6cff;
    opacity: 0.15;
    box-shadow: 0 0 10px rgba(80,120,255,0.2);
    transition: opacity 4s ease, box-shadow 4s ease;
}

.minute-ring {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    border-radius: 50%;
    background: conic-gradient(#aaaaaa 0deg, rgba(255,255,255,0.08) 0deg); /* Subtle gray */
    transition: background 0.6s ease;
}

/* Center & Hub */
.center {
    background: #222;
    border-radius: 50%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

.hub {
    position: absolute;
    background: white;
    border-radius: 50%;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 10;
}

/* Hands */
.hand {
    position: absolute;
    bottom: 50%;
    left: 50%;
    transform-origin: bottom;
    border-radius: 2px;
}

.hand::after {
    content: '';
    position: absolute;
    top: -6px;
    left: 50%;
    transform: translateX(-50%);
    width: 0;
    height: 0;
    border-left: 3px solid transparent;
    border-right: 3px solid transparent;
    border-bottom: 6px solid inherit; /* Inherit from hand background */
}

.hour { width: 2px; z-index: 4; transition: background 1s ease; }
.minute { width: 2px; background: white; z-index: 4; box-shadow: 0 0 4px rgba(170,170,170,0.5); /* Gray glow */ }
.second { width: 1px; background: #ff4d4d; box-shadow: 0 0 8px #ff4d4d66; z-index: 5; transition: transform 0.18s cubic-bezier(0.4, 2.0, 0.2, 1); }

/* Numbers & Marks */
.number {
    position: absolute;
    font-size: clamp(8px, 2.86vw, 12px);
    font-weight: bold;
    transform: translate(-50%, -50%);
}

.day-number { color: #222; }
.night-number { color: white; }

.minute-tick {
    position: absolute;
    width: 1.5px;
    background: rgba(255,255,255,0.75);
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 3;
    border-radius: 1px;
}

/* Labels */
#minuteLabel {
    position: absolute;
    color: #b9f2ff;
    font-size: clamp(0.75em, 2.5vw, 0.95em);
    font-weight: 800;
    pointer-events: none;
    z-index: 6;
    transform: translate(-50%, -50%);
    padding: 2px 8px;
    border-radius: 999px;
    background: rgba(2,10,24,0.78);
    border: 1px solid rgba(120,190,255,0.22);
    box-shadow: 0 0 10px rgba(0,229,255,0.35), inset 0 0 8px rgba(0,140,255,0.18);
}

.mode-label {
    margin: 0.5rem 0;
    padding: clamp(4px, 1.5vw, 6px) clamp(10px, 3.3vw, 14px);
    border-radius: 999px;
    font-size: clamp(0.65em, 2vw, 0.82em);
    font-weight: 700;
    letter-spacing: 2px;
    color: #b9f2ff;
    background: linear-gradient(180deg, rgba(8,18,44,0.90) 0%, rgba(4,10,26,0.90) 100%);
    border: 1px solid rgba(120,190,255,0.18);
    box-shadow: 0 0 14px rgba(0,160,255,0.18), inset 0 0 10px rgba(0,140,255,0.12);
}

.digital-box {
    margin-top: 0.5rem;
    padding: clamp(12px, 4.8vw, 20px) clamp(30px, 12vw, 50px);
    background: linear-gradient(180deg, rgba(8,18,44,0.95) 0%, rgba(4,10,26,0.95) 100%);
    border: 1px solid rgba(120,190,255,0.18);
    border-radius: 10px;
    box-shadow: 0 0 22px rgba(0,160,255,0.22), inset 0 0 14px rgba(0,140,255,0.18);
}

.digital-display {
    font-family: "DSEG7ClassicLocal", "Courier New", monospace;
    font-size: clamp(1.8em, 7vw, 3em);
    color: #b9f2ff;
    letter-spacing: clamp(3px, 1.4vw, 6px);
    text-shadow: 0 0 8px rgba(0,229,255,0.85), 0 0 22px rgba(0,160,255,0.55);
}

/* Toggle */
.toggle-container {
    margin: 0.5rem 0;
    display: flex;
    align-items: center;
    gap: 0.8rem;
    font-size: clamp(0.8rem, 2.5vw, 0.95rem);
}

.toggle-switch {
    position: relative;
    width: 44px;
    height: 24px;
}

.toggle-switch input { opacity: 0; width: 0; height: 0; }

.slider {
    position: absolute;
    cursor: pointer;
    inset: 0;
    background: #444;
    border-radius: 24px;
    transition: .4s;
}

.slider:before {
    position: absolute;
    content: "";
    height: 18px;
    width: 18px;
    left: 3px;
    bottom: 3px;
    background: white;
    border-radius: 50%;
    transition: .4s;
}

input:checked + .slider { background: #2196F3; }
input:checked + .slider:before { transform: translateX(20px); }
</style>
</head>
<body>

<div class="clock-container">
    <div class="clock">
        <div class="circle day-ring"></div>
        <div class="circle night-ring"></div>
        <div class="minute-ring" id="minuteRing"></div>

        <div class="hand hour" id="hourHand"></div>
        <div class="hand minute" id="minuteHand"></div>
        <div class="hand second" id="secondHand"></div>

        <div id="minuteLabel"></div>
        <div class="center"></div>
        <div class="hub"></div>
    </div>
</div>

<div class="mode-label" id="mode"></div>

<div class="toggle-container">
    <label for="secondsToggle">Vis sekundviser</label>
    <label class="toggle-switch">
        <input type="checkbox" id="secondsToggle" checked>
        <span class="slider"></span>
    </label>
</div>

<div class="digital-box">
    <div class="digital-display" id="digital"></div>
</div>

<script>
const clock = document.querySelector(".clock");
const hourHand = document.getElementById("hourHand");
const minuteHand = document.getElementById("minuteHand");
const secondHand = document.getElementById("secondHand");
const minuteRing = document.getElementById("minuteRing");
const minuteLabel = document.getElementById("minuteLabel");
const modeLabel = document.getElementById("mode");
const digital = document.getElementById("digital");
const toggle = document.getElementById("secondsToggle");
const dayRing = document.querySelector(".day-ring");
const nightRing = document.querySelector(".night-ring");
const centerDiv = document.querySelector(".center");
const hub = document.querySelector(".hub");

let showSeconds = localStorage.getItem("showSeconds") !== "false";
toggle.checked = showSeconds;
secondHand.style.display = showSeconds ? "block" : "none";

toggle.addEventListener("change", () => {
    showSeconds = toggle.checked;
    localStorage.setItem("showSeconds", showSeconds);
    secondHand.style.display = showSeconds ? "block" : "none";
});

let center, borderW, dayR, nightR, labelR, minuteRingRadius;

const dayNumbers = [];
const nightNumbers = [];
const minuteTicks = [];

function initElements() {
    dayNumbers.forEach(n => n.remove());
    nightNumbers.forEach(n => n.remove());
    minuteTicks.forEach(t => t.remove());
    dayNumbers.length = 0;
    nightNumbers.length = 0;
    minuteTicks.length = 0;

    for (let i = 0; i < 12; i++) {
        let num = document.createElement("div");
        num.className = "number day-number";
        num.textContent = (12 + i).toString().padStart(2, "0");
        const angle = (i / 12) * 360 - 90;
        const rad = angle * Math.PI / 180;
        num.style.left = center + dayR * Math.cos(rad) + "px";
        num.style.top = center + dayR * Math.sin(rad) + "px";
        clock.appendChild(num);
        dayNumbers.push(num);
    }

    for (let i = 0; i < 12; i++) {
        let num = document.createElement("div");
        num.className = "number night-number";
        num.textContent = i.toString().padStart(2, "0");
        const angle = (i / 12) * 360 - 90;
        const rad = angle * Math.PI / 180;
        num.style.left = center + nightR * Math.cos(rad) + "px";
        num.style.top = center + nightR * Math.sin(rad) + "px";
        clock.appendChild(num);
        nightNumbers.push(num);
    }

    for (let i = 0; i < 60; i++) {
        let tick = document.createElement("div");
        tick.className = "minute-tick";
        const isFiveMin = i % 5 === 0;
        tick.style.height = isFiveMin ? "12px" : "5px";
        tick.style.opacity = isFiveMin ? 0.9 : 0.6;
        const angle = (i / 60) * 360;
        const adjustY = minuteRingRadius - (parseFloat(tick.style.height) / 2);
        tick.style.transform = `translate(-50%, -50%) rotate(${angle}deg) translateY(-${adjustY}px)`;
        clock.appendChild(tick);
        minuteTicks.push(tick);
    }
}

function setSizes() {
    const size = clock.clientWidth;
    center = size / 2;
    borderW = size / 420 * 20;
    const minuteRingW = size * 300 / 420;
    const centerW = size * 260 / 420;
    const hubS = size / 420 * 6;
    dayR = size * 200 / 420;
    nightR = size * 175 / 420;
    labelR = size * 115 / 420;
    minuteRingRadius = minuteRingW / 2;

    dayRing.style.width = size + "px";
    dayRing.style.height = size + "px";
    dayRing.style.borderWidth = borderW + "px";

    nightRing.style.width = size * 370 / 420 + "px";
    nightRing.style.height = size * 370 / 420 + "px";
    nightRing.style.borderWidth = borderW + "px";

    minuteRing.style.width = minuteRingW + "px";
    minuteRing.style.height = minuteRingW + "px";

    centerDiv.style.width = centerW + "px";
    centerDiv.style.height = centerW + "px";

    hourHand.style.height = size * 120 / 420 + "px";
    minuteHand.style.height = size * 170 / 420 + "px";
    secondHand.style.height = size * 185 / 420 + "px";

    hub.style.width = hubS + "px";
    hub.style.height = hubS + "px";

    initElements();
}

function getTwilightFactor(h, m) {
    const minOfDay = h * 60 + m;
    const sunrise = 6 * 60;
    const sunset = 18 * 60;
    const window = 45;

    let dSunrise = Math.abs(minOfDay - sunrise);
    let dSunset = Math.abs(minOfDay - sunset);

    if (dSunrise < window) return (window - dSunrise) / window;
    if (dSunset < window) return (window - dSunset) / window;
    return (minOfDay >= sunrise && minOfDay < sunset) ? 1 : 0;
}

function updateClock() {
    const now = new Date();
    const h = now.getHours();
    const m = now.getMinutes();
    const s = now.getSeconds();

    const hDeg = ((h % 12) + m / 60 + s / 3600) * 30;
    const mDeg = (m + s / 60) * 6;
    const sDeg = s * 6;

    hourHand.style.transform = `translateX(-50%) rotate(${hDeg}deg)`;
    minuteHand.style.transform = `translateX(-50%) rotate(${mDeg}deg)`;
    if (showSeconds) {
        secondHand.style.transform = `translateX(-50%) rotate(${sDeg}deg)`;
    }

    const colon = (s % 2 === 0) ? ":" : " ";
    digital.textContent = String(h).padStart(2, "0") + colon + String(m).padStart(2, "0");

    const tf = getTwilightFactor(h, m);

    dayRing.style.opacity = 0.15 + 0.85 * tf;
    dayRing.style.boxShadow = `0 0 ${10 + 30 * tf}px rgba(255,200,50,${0.2 + 0.5 * tf})`;

    nightRing.style.opacity = 0.15 + 0.85 * (1 - tf);
    nightRing.style.boxShadow = `0 0 ${10 + 30 * (1 - tf)}px rgba(80,120,255,${0.2 + 0.5 * (1 - tf)})`;

    const fromR = Math.round(42 * tf + 10 * (1 - tf));
    const fromG = Math.round(34 * tf + 19 * (1 - tf));
    const fromB = Math.round(8 * tf + 48 * (1 - tf));
    const toR = Math.round(15 * tf + 5 * (1 - tf));
    const toG = Math.round(15 * tf + 7 * (1 - tf));
    const toB = Math.round(15 * tf + 15 * (1 - tf));

    document.body.style.background = `radial-gradient(circle at center, rgb(${fromR},${fromG},${fromB}) 0%, rgb(${toR},${toG},${toB}) 70%)`;

    modeLabel.textContent = tf > 0.65 ? "DAG/KVELD" : tf < 0.35 ? "NATT/MORGEN" : "SKUMRING";

    const isDay = tf > 0.5;
    hourHand.style.background = isDay ? '#ffd700' : '#4a6cff';

    const minFrac = (m + s / 60) / 60;
    minuteRing.style.background = `conic-gradient(#aaaaaa ${minFrac * 360}deg, rgba(255,255,255,0.08) ${minFrac * 360}deg)`;

    const rad = (mDeg - 90) * Math.PI / 180;
    minuteLabel.style.left = center + labelR * Math.cos(rad) + "px";
    minuteLabel.style.top = center + labelR * Math.sin(rad) + "px";
    minuteLabel.textContent = String(m).padStart(2, "0");
}

setSizes();
updateClock();
setInterval(updateClock, 200);

window.addEventListener("resize", () => {
    setSizes();
    updateClock();
});
</script>
</body>
</html>